(function(){var a;a=(function(){var d,c;d={m:"his",f:"her"};c={escape:27,up:38,down:40,enter:13};function b(){this.html=$("html");this.initGender();this.initUsername();this.initPlaylists();this.initSongs()}b.prototype.initGender=function(){this.genderSpan=$("#gender");return this.currentGender=d.m};b.prototype.updateGender=function(f){var e;e=d[f];if(e===this.currentGender){return}this.currentGender=e;return this.genderSpan.html(e)};b.prototype.initUsername=function(){var e=this;this.currentUsername="";this.usernameInput=$("#username");this.userInput=$('input[name="user"]');this.userSpan=$("#user");this.avatarSpan=this.userSpan.children(".icon");this.usernameInput.on("blur",function(f){var g;g=e.usernameInput.val().toLowerCase();if(g===e.currentUsername){return}e.currentUsername=g;e.playlistsSelect.attr("disabled",true);if(g===""){e.userSpan.removeClass("has-icon");e.avatarSpan.html("");return}e.html.addClass("loading");return $.ajax({url:"/"+g+"/playlists",success:function(h){e.html.removeClass("loading");e.userSpan.removeClass("has-icon");e.avatarSpan.html("");if(!h){return}h=JSON.parse(h);e.userInput.val(JSON.stringify(h.user));e.updateUser(h.user);e.updateGender(h.user.gender);return e.updatePlaylists(h.playlists)}})});return this.usernameInput.on("keypress",function(f){if(f.keyCode!==c.enter){return}return e.usernameInput.trigger("blur")})};b.prototype.updateUser=function(e){this.avatarSpan.html("<img src='"+e.icon+"' alt='"+e.firstName+"'>");return this.userSpan.addClass("has-icon")};b.prototype.initPlaylists=function(){return this.playlistsSelect=$('select[name="playlists"]')};b.prototype.updatePlaylists=function(g){var i,e,h,f;e="";for(h=0,f=g.length;h<f;h++){i=g[h];e+="<option value='"+(JSON.stringify(i).replace(/'/g,"&rsquo;"))+"'>"+i.name+"</option>"}this.playlistsSelect.removeAttr("disabled");return this.playlistsSelect.html(e)};b.prototype.initSongs=function(){var f,e=this;this.currentSong="";f=null;this.songRequest=null;this.songInput=$('input[name="song"]');this.songNameInput=$("#song-name");this.songSpan=$("#song");this.songList=this.songSpan.children("ul");this.songIconSpan=this.songSpan.children(".icon");this.songNameInput.on("keyup",function(g){clearTimeout(f);return f=setTimeout(function(){var i,h;i=e.songNameInput.val();if(i===e.currentSong){return}e.currentSong=i;if(i===""){return}e.html.addClass("loading");if((h=e.songRequest)!=null){h.abort()}return e.songRequest=$.ajax({url:"/search/"+(i.replace(" ","+")),success:function(j){e.html.removeClass("loading");if(!j){return}j=JSON.parse(j);if(j.results.length>0){return e.updateSongs(j.results)}}})},250)});this.songNameInput.on("keydown",function(g){var h;if(g.keyCode!==c.down){return}g.preventDefault();if((h=e.songList.find("li:first-child a")).length){return h.focus()}});this.songList.on("click","a",function(j){var g,k,i,h;g=$(j.currentTarget);k=g.attr("data-name");i=g.attr("data-song");h=g.attr("data-icon");e.songNameInput.val(k);e.songInput.val(i);e.songIconSpan.html("<img src='"+h+"' alt='"+k+"'>");e.songSpan.addClass("has-icon");return e.updateSongs()});this.songList.on("keydown","a",function(j){var i,h,g;if([c.up,c.down].indexOf(j.keyCode)===-1){return}j.preventDefault();g=$(j.currentTarget);i=g.parent("li");switch(j.keyCode){case c.up:if((h=i.prev("li")).length){return h.children("a").focus()}else{return e.songNameInput.focus()}break;case c.down:return i.next("li").children("a").focus()}});return $(document).on("keydown",function(g){if(g.keyCode!==c.escape){return}return e.updateSongs()})};b.prototype.updateSongs=function(h){var i,e,g,f;if(h==null){h=[]}if(!h.length){return this.songList.html("")}e="";for(g=0,f=h.length;g<f;g++){i=h[g];e+='<li>\n  <a data-name="'+i.name+"\" data-song='"+(JSON.stringify(i).replace(/'/g,"&rsquo;"))+"' data-icon=\""+i.icon+'" href="javascript:">\n    <div class="img">\n      <img src="'+i.icon+'">\n    </div>\n    <div class="song">\n      <span class="name">'+i.name+'</span>\n      <span class="artist">'+i.albumArtist+"</span>\n    </div>\n  </a>\n</li>"}return this.songList.html(e)};return b})();new a}).call(this);